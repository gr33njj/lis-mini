<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—Ç–ª–∞–¥–∫–∞ –õ–ò–° –ú–î</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test { margin: 10px 0; padding: 10px; border: 1px solid #ddd; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        button { padding: 8px 16px; margin: 5px; background: #007bff; color: white; border: none; cursor: pointer; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>üîß –û—Ç–ª–∞–¥–∫–∞ —Å–∏—Å—Ç–µ–º—ã –õ–ò–° –ú–î</h1>

    <div class="test">
        <h3>–®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ JavaScript</h3>
        <button onclick="testJS()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å JavaScript</button>
        <div id="js-result"></div>
    </div>

    <div class="test">
        <h3>–®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ API –ª–æ–≥–∏–Ω–∞</h3>
        <button onclick="testLoginAPI()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–Ω API</button>
        <div id="login-result"></div>
    </div>

    <div class="test">
        <h3>–®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ª–æ–≥–∏–Ω–∞</h3>
        <button onclick="testLoginPage()">–û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –ª–æ–≥–∏–Ω–∞</button>
        <div id="page-result"></div>
    </div>

    <div class="test">
        <h3>–®–∞–≥ 4: –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–µ—Ç–∏</h3>
        <button onclick="testNetwork()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ç–µ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã</button>
        <div id="network-result"></div>
    </div>

    <div class="test">
        <h3>–®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤</h3>
        <button onclick="checkToken()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–∫–µ–Ω –≤ localStorage</button>
        <button onclick="clearToken()">–û—á–∏—Å—Ç–∏—Ç—å —Ç–æ–∫–µ–Ω</button>
        <div id="token-result"></div>
    </div>

    <script>
        function testJS() {
            const result = document.getElementById('js-result');
            result.innerHTML = '<div class="success">‚úÖ JavaScript —Ä–∞–±–æ—Ç–∞–µ—Ç!</div>';
        }

        async function testLoginAPI() {
            const result = document.getElementById('login-result');
            result.innerHTML = '<div class="warning">‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞...</div>';

            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: 'admin', password: 'changeme' })
                });

                if (response.ok) {
                    const data = await response.json();
                    result.innerHTML = `<div class="success">‚úÖ –õ–æ–≥–∏–Ω —É—Å–ø–µ—à–µ–Ω! –¢–æ–∫–µ–Ω: ${data.access_token.substring(0, 50)}...</div>`;
                    localStorage.setItem('access_token', data.access_token);
                } else {
                    result.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞: ${response.status}</div>`;
                }
            } catch (error) {
                result.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}</div>`;
            }
        }

        function testLoginPage() {
            const result = document.getElementById('page-result');
            window.open('/login', '_blank');
            result.innerHTML = '<div class="success">‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ª–æ–≥–∏–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∞ –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ</div>';
        }

        async function testNetwork() {
            const result = document.getElementById('network-result');
            result.innerHTML = '<div class="warning">‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–∏...</div>';

            try {
                const response = await fetch('/health');
                if (response.ok) {
                    result.innerHTML = '<div class="success">‚úÖ –°–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç</div>';
                } else {
                    result.innerHTML = `<div class="error">‚ùå –°–µ—Ä–≤–µ—Ä –æ—à–∏–±–∫–∞: ${response.status}</div>`;
                }
            } catch (error) {
                result.innerHTML = `<div class="error">‚ùå –ù–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}</div>`;
            }
        }

        function checkToken() {
            const result = document.getElementById('token-result');
            const token = localStorage.getItem('access_token');

            if (token) {
                result.innerHTML = `<div class="success">‚úÖ –¢–æ–∫–µ–Ω –Ω–∞–π–¥–µ–Ω: ${token.substring(0, 50)}...</div>`;
            } else {
                result.innerHTML = '<div class="warning">‚ö†Ô∏è –¢–æ–∫–µ–Ω –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</div>';
            }
        }

        function clearToken() {
            localStorage.removeItem('access_token');
            document.getElementById('token-result').innerHTML = '<div class="success">‚úÖ –¢–æ–∫–µ–Ω –æ—á–∏—â–µ–Ω</div>';
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', function() {
            testNetwork();
            checkToken();
        });
    </script>
</body>
</html>
