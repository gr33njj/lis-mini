<!DOCTYPE html>
<html>
<head>
    <title>–ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç –õ–ò–° –ú–î</title>
    <meta charset="utf-8">
</head>
<body>
    <h1>üß™ –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç –õ–ò–° –ú–î</h1>

    <div id="status">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...</div>

    <h2>–®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞</h2>
    <button onclick="testServer()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ä–≤–µ—Ä</button>
    <div id="server-result"></div>

    <h2>–®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ JavaScript</h2>
    <button onclick="testJS()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å JavaScript</button>
    <div id="js-result"></div>

    <h2>–®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ localStorage</h2>
    <button onclick="testStorage()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å localStorage</button>
    <div id="storage-result"></div>

    <h2>–®–∞–≥ 4: –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç –ª–æ–≥–∏–Ω–∞</h2>
    <button onclick="fullTest()">–ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç –ª–æ–≥–∏–Ω–∞</button>
    <div id="full-result"></div>

    <script>
        async function testServer() {
            const result = document.getElementById('server-result');
            try {
                const response = await fetch('/health');
                if (response.ok) {
                    result.innerHTML = '<div style="color: green;">‚úÖ –°–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç</div>';
                } else {
                    result.innerHTML = '<div style="color: red;">‚ùå –°–µ—Ä–≤–µ—Ä –æ—à–∏–±–∫–∞: ' + response.status + '</div>';
                }
            } catch (error) {
                result.innerHTML = '<div style="color: red;">‚ùå –ù–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ' + error.message + '</div>';
            }
        }

        function testJS() {
            const result = document.getElementById('js-result');
            result.innerHTML = '<div style="color: green;">‚úÖ JavaScript —Ä–∞–±–æ—Ç–∞–µ—Ç!</div>';
        }

        function testStorage() {
            const result = document.getElementById('storage-result');
            try {
                localStorage.setItem('test', 'value');
                const value = localStorage.getItem('test');
                if (value === 'value') {
                    result.innerHTML = '<div style="color: green;">‚úÖ localStorage —Ä–∞–±–æ—Ç–∞–µ—Ç</div>';
                } else {
                    result.innerHTML = '<div style="color: red;">‚ùå localStorage –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç</div>';
                }
                localStorage.removeItem('test');
            } catch (error) {
                result.innerHTML = '<div style="color: red;">‚ùå –û—à–∏–±–∫–∞ localStorage: ' + error.message + '</div>';
            }
        }

        async function fullTest() {
            const result = document.getElementById('full-result');
            result.innerHTML = '<div style="color: orange;">‚è≥ –¢–µ—Å—Ç–∏—Ä—É—é –ª–æ–≥–∏–Ω...</div>';

            try {
                // –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
                const healthResponse = await fetch('/health');
                if (!healthResponse.ok) {
                    result.innerHTML = '<div style="color: red;">‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</div>';
                    return;
                }

                // –¢–µ—Å—Ç 2: –õ–æ–≥–∏–Ω
                const loginResponse = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: 'admin', password: 'changeme' })
                });

                if (loginResponse.ok) {
                    const data = await loginResponse.json();
                    result.innerHTML = '<div style="color: green;">‚úÖ –õ–æ–≥–∏–Ω —É—Å–ø–µ—à–µ–Ω! –¢–æ–∫–µ–Ω –ø–æ–ª—É—á–µ–Ω.</div>';

                    // –¢–µ—Å—Ç 3: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
                    localStorage.setItem('access_token', data.access_token);

                    // –¢–µ—Å—Ç 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞
                    const token = localStorage.getItem('access_token');
                    if (token) {
                        result.innerHTML += '<div style="color: green;">‚úÖ –¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ localStorage</div>';

                        // –¢–µ—Å—Ç 5: –î–æ—Å—Ç—É–ø –∫ –∑–∞—â–∏—â–µ–Ω–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
                        const protectedResponse = await fetch('/', {
                            headers: { 'Authorization': 'Bearer ' + token }
                        });

                        if (protectedResponse.ok) {
                            result.innerHTML += '<div style="color: green;">‚úÖ –î–æ—Å—Ç—É–ø –∫ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø–æ–ª—É—á–µ–Ω</div>';
                        } else {
                            result.innerHTML += '<div style="color: red;">‚ùå –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ: ' + protectedResponse.status + '</div>';
                        }
                    } else {
                        result.innerHTML += '<div style="color: red;">‚ùå –¢–æ–∫–µ–Ω –Ω–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω</div>';
                    }
                } else {
                    result.innerHTML = '<div style="color: red;">‚ùå –õ–æ–≥–∏–Ω –Ω–µ—É–¥–∞—á–µ–Ω: ' + loginResponse.status + '</div>';
                }
            } catch (error) {
                result.innerHTML = '<div style="color: red;">‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error.message + '</div>';
            }
        }

        // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
        window.addEventListener('load', function() {
            document.getElementById('status').innerHTML = '<div style="color: green;">‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞</div>';
        });
    </script>
</body>
</html>
