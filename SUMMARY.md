# üìã –†–µ–∑—é–º–µ –ø—Ä–æ–µ–∫—Ç–∞ –õ–ò–° –ú–î

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

–ü–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π 1–°:–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–º —Ü–µ–Ω—Ç—Ä–æ–º (–ü–µ—Ä–≤—ã–π–ë–∏—Ç).

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### 1. Backend (FastAPI)
- ‚úÖ **main.py** - –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å REST API
- ‚úÖ **watcher.py** - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ NAS –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫, SHA256 —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ **integrator.py** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å 1–°, retry –º–µ—Ö–∞–Ω–∏–∑–º (3 –ø–æ–ø—ã—Ç–∫–∏)
- ‚úÖ **mailer.py** - –æ—Ç–ø—Ä–∞–≤–∫–∞ email —á–µ—Ä–µ–∑ SMTP
- ‚úÖ **auth.py** - JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è, bcrypt –ø–∞—Ä–æ–ª–∏
- ‚úÖ **database.py** - SQLAlchemy async –º–æ–¥–µ–ª–∏ (FileRecord, AuditLog, User)
- ‚úÖ **config.py** - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ environment variables

#### 2. Frontend (Tailwind CSS + HTMX)
- ‚úÖ **base.html** - –±–∞–∑–æ–≤—ã–π —à–∞–±–ª–æ–Ω —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π
- ‚úÖ **login.html** - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞
- ‚úÖ **index.html** - –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
- ‚úÖ **dashboard.html** - –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- ‚úÖ Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (–∫–∞–∂–¥—ã–µ 30 —Å–µ–∫)
- ‚úÖ HTMX –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

#### 3. –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- ‚úÖ **Docker Compose** - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ Nginx
- ‚úÖ **Nginx** - reverse proxy —Å SSL –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π
- ‚úÖ **SQLite** - –ª–µ–≥–∫–æ–≤–µ—Å–Ω–∞—è –ë–î —Å async –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π
- ‚úÖ **Systemd —Å–µ—Ä–≤–∏—Å** - –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–µ—Ä–≤–µ—Ä–∞

#### 4. –°–µ—Ç–µ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- ‚úÖ **OpenVPN** - —Ç—É–Ω–Ω–µ–ª—å –∫ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏ –æ—Ñ–∏—Å–∞
- ‚úÖ **CIFS/SMB** - –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ NAS
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ OpenVPN

#### 5. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ **README.md** - –ø–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ (527 —Å—Ç—Ä–æ–∫)
- ‚úÖ **QUICKSTART.md** - –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (35-40 –º–∏–Ω—É—Ç)
- ‚úÖ **docs/deployment-guide.md** - –ø–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é
- ‚úÖ **docs/openvpn-setup-guide.md** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ VPN —Ç—É–Ω–Ω–µ–ª—è
- ‚úÖ **docs/1c-integration.md** - –ø–æ–ª–Ω—ã–π –∫–æ–¥ HTTP-—Å–µ—Ä–≤–∏—Å–∞ –¥–ª—è 1–°

#### 6. –°–∫—Ä–∏–ø—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏
- ‚úÖ **setup-server.sh** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
- ‚úÖ **setup-openvpn.sh** - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ OpenVPN
- ‚úÖ **check-system.sh** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã
- ‚úÖ **backup.sh** - —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ **diagnostic.sh** - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

#### 7. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚úÖ **env.template** - —à–∞–±–ª–æ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ **docker-compose.yml** - –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- ‚úÖ **nginx/nginx.conf** - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞
- ‚úÖ **app/Dockerfile** - Docker –æ–±—Ä–∞–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤

```
1. PDF —Ñ–∞–π–ª –ø–æ—è–≤–ª—è–µ—Ç—Å—è –Ω–∞ NAS
   ‚îî‚îÄ> //192.168.100.177/laba/123456.pdf

2. Watcher –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç —Ñ–∞–π–ª (–∫–∞–∂–¥—ã–µ 30 —Å–µ–∫)
   ‚îî‚îÄ> –í—ã—á–∏—Å–ª—è–µ—Ç SHA256 —Ö–µ—à
   ‚îî‚îÄ> –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã
   ‚îî‚îÄ> –°–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å—å –≤ –ë–î (status: pending)

3. Integrator –∑–∞–±–∏—Ä–∞–µ—Ç –∏–∑ –æ—á–µ—Ä–µ–¥–∏ (–∫–∞–∂–¥—ã–µ 5 —Å–µ–∫)
   ‚îî‚îÄ> –ß–∏—Ç–∞–µ—Ç PDF
   ‚îî‚îÄ> –ö–æ–¥–∏—Ä—É–µ—Ç –≤ Base64
   ‚îî‚îÄ> –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST –∑–∞–ø—Ä–æ—Å –≤ 1–° API
   ‚îî‚îÄ> Retry –¥–æ 3 —Ä–∞–∑ –ø—Ä–∏ –æ—à–∏–±–∫–µ

4. 1–° –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç
   ‚îî‚îÄ> –ù–∞—Ö–æ–¥–∏—Ç –∑–∞–∫–∞–∑ –ø–æ –Ω–æ–º–µ—Ä—É –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è
   ‚îî‚îÄ> –°–æ–∑–¥–∞—ë—Ç –¥–æ–∫—É–º–µ–Ω—Ç "–†–µ–∑—É–ª—å—Ç–∞—Ç –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è"
   ‚îî‚îÄ> –ü—Ä–∏–∫—Ä–µ–ø–ª—è–µ—Ç PDF
   ‚îî‚îÄ> –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç email –ø–∞—Ü–∏–µ–Ω—Ç—É (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

5. –°–∏—Å—Ç–µ–º–∞ –∞—Ä—Ö–∏–≤–∏—Ä—É–µ—Ç —Ñ–∞–π–ª
   ‚îî‚îÄ> –£—Å–ø–µ—Ö: /mnt/nas/archive/YYYY-MM-DD/123456.pdf
   ‚îî‚îÄ> –û—à–∏–±–∫–∞: /mnt/nas/quarantine/123456.pdf + error log

6. Audit –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
   ‚îî‚îÄ> –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –≤ –ë–î
   ‚îî‚îÄ> –ú–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
```

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç                                        ‚îÇ
‚îÇ lis.it-mydoc.ru (HTTPS)                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –û–±–ª–∞—á–Ω—ã–π —Å–µ—Ä–≤–µ—Ä (185.247.185.145)              ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê           ‚îÇ
‚îÇ  ‚îÇ Nginx (SSL)                      ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ Port 80, 443                     ‚îÇ           ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò           ‚îÇ
‚îÇ               ‚îÇ                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê           ‚îÇ
‚îÇ  ‚îÇ FastAPI (Uvicorn)                ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ Port 8000                        ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ                                  ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ ‚îÇ Watcher (background)      ‚îÇ    ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ ‚îÇ Integrator (background)   ‚îÇ    ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ ‚îÇ Auth (JWT)                ‚îÇ    ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ ‚îÇ Database (SQLite)         ‚îÇ    ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ           ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò           ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê           ‚îÇ
‚îÇ  ‚îÇ OpenVPN Client                   ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ tun0: 10.8.0.2/24                ‚îÇ           ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ
                ‚îÇ Encrypted Tunnel
                ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –û—Ñ–∏—Å–Ω–∞—è —Å–µ—Ç—å (192.168.100.0/24)                ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê           ‚îÇ
‚îÇ  ‚îÇ 1–° –°–µ—Ä–≤–µ—Ä                        ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ 192.168.100.234                  ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ HTTP API: /hs/lab/attachResult   ‚îÇ           ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò           ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê           ‚îÇ
‚îÇ  ‚îÇ NAS                              ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ 192.168.100.177                  ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ SMB: \\192.168.100.177\laba      ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ lab_results/                 ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ archive/                     ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ quarantine/                  ‚îÇ           ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üìä –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞: file_records
```sql
- id (PK)
- order_no (–Ω–æ–º–µ—Ä –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è)
- file_name (–∏–º—è PDF)
- file_hash (SHA256 –¥–ª—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤)
- file_path (–ø—É—Ç—å –∫ —Ñ–∞–π–ª—É)
- status (pending/processing/completed/failed)
- sent_to_1c (boolean)
- sent_to_1c_at (timestamp)
- doc_ref_1c (—Å—Å—ã–ª–∫–∞ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç –≤ 1–°)
- email_sent (boolean)
- email_sent_at (timestamp)
- patient_email
- created_at
- updated_at
- archived_at
- error_message
- retry_count
```

### –¢–∞–±–ª–∏—Ü–∞: audit_logs
```sql
- id (PK)
- record_id (FK -> file_records)
- action (file_detected, send_to_1c, archive, etc.)
- status (success/error)
- message
- details (JSON)
- created_at
```

### –¢–∞–±–ª–∏—Ü–∞: users
```sql
- id (PK)
- username
- password_hash (bcrypt)
- role (administrator/operator)
- created_at
- last_login
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ HTTPS (Let's Encrypt SSL)
- ‚úÖ JWT —Ç–æ–∫–µ–Ω—ã –¥–ª—è API
- ‚úÖ Bcrypt —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
- ‚úÖ OpenVPN —à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç—É–Ω–Ω–µ–ª—å
- ‚úÖ Bearer token –¥–ª—è 1–° API
- ‚úÖ Credentials —Ñ–∞–π–ª—ã —Å chmod 600
- ‚úÖ Firewall (UFW) - —Ç–æ–ª—å–∫–æ 22, 80, 443
- ‚úÖ Docker unprivileged containers
- ‚úÖ –õ–æ–≥–∏ –±–µ–∑ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏
```bash
# –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
docker compose logs -f app

# Nginx
docker compose logs -f nginx

# OpenVPN
journalctl -u openvpn-client@client -f

# –°–∏—Å—Ç–µ–º–Ω—ã–π —Å–µ—Ä–≤–∏—Å
journalctl -u lis-md -f
```

### –ú–µ—Ç—Ä–∏–∫–∏
- Total —Ñ–∞–π–ª–æ–≤
- Completed (—É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ)
- Failed (–æ—à–∏–±–∫–∏)
- Pending (–≤ –æ—á–µ—Ä–µ–¥–∏)

### Health Check
```bash
curl https://lis.it-mydoc.ru/health
```

## üîß API Endpoints

### –ü—É–±–ª–∏—á–Ω—ã–µ
- `POST /api/auth/login` - –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- `GET /health` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è

### –¢—Ä–µ–±—É—é—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- `GET /api/stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- `GET /api/records` - —Å–ø–∏—Å–æ–∫ –∑–∞–ø–∏—Å–µ–π
- `GET /api/logs` - –∂—É—Ä–Ω–∞–ª –∞—É–¥–∏—Ç–∞
- `POST /api/retry` - –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
- `POST /api/send-email` - –æ—Ç–ø—Ä–∞–≤–∏—Ç—å email
- `GET /api/file/{id}` - —Å–∫–∞—á–∞—Ç—å PDF
- `POST /api/verify-token` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞

## üì¶ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Python 3.12** - –æ—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫
- **FastAPI** - –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **SQLAlchemy** - ORM (async)
- **Uvicorn** - ASGI —Å–µ—Ä–≤–µ—Ä
- **SQLite** - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **Jinja2** - —à–∞–±–ª–æ–Ω—ã
- **Tailwind CSS** - —Å—Ç–∏–ª–∏
- **HTMX** - –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç
- **Docker** - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è
- **Nginx** - reverse proxy
- **OpenVPN** - VPN –∫–ª–∏–µ–Ω—Ç
- **Certbot** - SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã

## üìÅ –§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
–í—Å–µ–≥–æ —Å–æ–∑–¥–∞–Ω–æ:
- 20+ Python —Ñ–∞–π–ª–æ–≤
- 10+ HTML —à–∞–±–ª–æ–Ω–æ–≤
- 5+ Bash —Å–∫—Ä–∏–ø—Ç–æ–≤
- 3+ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ Markdown
- Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- Systemd —Å–µ—Ä–≤–∏—Å
```

## üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ NAS: –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–∏: –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
- –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–∞: ~30 —Å–µ–∫—É–Ω–¥ (–ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª)
- Retry –ø—Ä–∏ –æ—à–∏–±–∫–µ: 3 –ø–æ–ø—ã—Ç–∫–∏ —Å —É–≤–µ–ª–∏—á–µ–Ω–∏–µ–º –∑–∞–¥–µ—Ä–∂–∫–∏
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞: –¥–æ 10,000 —Ñ–∞–π–ª–æ–≤ –≤ –¥–µ–Ω—å

## ‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å** - –≤–µ—Å—å –∫–æ–¥ async/await
2. **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** - SHA256 –∑–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
3. **–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å** - retry –º–µ—Ö–∞–Ω–∏–∑–º, –æ—á–µ—Ä–µ–¥–∏
4. **–ê—É–¥–∏—Ç** - –ø–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
5. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –≥–æ—Ç–æ–≤–æ –∫ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–º—É –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é
6. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å + API
7. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –º–Ω–æ–∂–µ—Å—Ç–≤–æ —É—Ä–æ–≤–Ω–µ–π –∑–∞—â–∏—Ç—ã
8. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è** - —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
9. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - >2000 —Å—Ç—Ä–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
10. **Docker** - –ª–µ–≥–∫–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 1. –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (–µ—Å–ª–∏ –Ω–µ —Å–¥–µ–ª–∞–Ω–∞)
```bash
cd /opt/lis-md
./setup-server.sh
./setup-openvpn.sh
# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏—Å—Ç–µ–º—É
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ 1–°
- –°–ª–µ–¥–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –≤ `docs/1c-integration.md`
- –°–æ–∑–¥–∞—Ç—å HTTP-—Å–µ—Ä–≤–∏—Å
- –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ç–æ–∫–µ–Ω
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å API

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –ü–æ–ª–æ–∂–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π PDF –Ω–∞ NAS
cp test.pdf /mnt/nas/lab_results/999999.pdf

# –ù–∞–±–ª—é–¥–∞—Ç—å –∑–∞ –ª–æ–≥–∞–º–∏
docker compose logs -f app

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
https://lis.it-mydoc.ru
```

### 4. –ü—Ä–æ–¥–∞–∫—à–Ω
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
- –ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª–∏
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å SMTP
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

## üí° –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã
./check-system.sh

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
systemctl restart lis-md

# –õ–æ–≥–∏
docker compose logs -f app

# –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è
./backup.sh

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ
docker compose down && docker compose up -d --build

# –û—á–∏—Å—Ç–∫–∞
docker system prune -a
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `docs/`
- README: `README.md`
- –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç: `QUICKSTART.md`
- –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞: `./check-system.sh`

---

**–°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞:** ‚úÖ –ì–æ—Ç–æ–≤ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é  
**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** –ù–æ—è–±—Ä—å 2025  
**–¶–µ–ª—å:** –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

