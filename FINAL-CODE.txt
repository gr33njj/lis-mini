// СКОПИРУЙ ЭТОТ КОД ЦЕЛИКОМ В МОДУЛЬ HTTP-СЕРВИСА

Функция testPOST(Запрос)
    Ответ = Новый HTTPСервисОтвет(200);
    Ответ.Заголовки.Вставить("Content-Type", "application/json");
    Ответ.УстановитьТелоИзСтроки("{""status"":""ok""}");
    Возврат Ответ;
КонецФункции

Функция attachResultPOST(Запрос)
    Ответ = Новый HTTPСервисОтвет(200);
    Ответ.Заголовки.Вставить("Content-Type", "application/json");
    
    Попытка
        Тело = Запрос.ПолучитьТелоКакСтроку();
        
        Если ПустаяСтрока(Тело) Тогда
            Ответ.КодСостояния = 400;
            Ответ.УстановитьТелоИзСтроки("{""error"":""empty""}");
            Возврат Ответ;
        КонецЕсли;
        
        Чтение = Новый ЧтениеJSON;
        Чтение.УстановитьСтроку(Тело);
        Данные = ПрочитатьJSON(Чтение);
        Чтение.Закрыть();
        
        НомерЗаказа = "";
        Если ТипЗнч(Данные) = Тип("Соответствие") Тогда
            НомерЗаказа = Данные.Получить("orderNo");
        ИначеЕсли ТипЗнч(Данные) = Тип("Структура") Тогда
            Если Данные.Свойство("orderNo") Тогда НомерЗаказа = Данные.orderNo; КонецЕсли;
        КонецЕсли;
        
        Если ПустаяСтрока(НомерЗаказа) Тогда
            Ответ.КодСостояния = 400;
            Ответ.УстановитьТелоИзСтроки("{""error"":""orderNo required""}");
            Возврат Ответ;
        КонецЕсли;
        
        Запрос1С = Новый Запрос;
        Запрос1С.Текст = 
        "ВЫБРАТЬ ПЕРВЫЕ 1
        |    Т.Ссылка
        |ИЗ
        |    Документ.ЗаказНаИсследование КАК Т
        |ГДЕ
        |    Т.НомерИсследования = &Номер";
        
        Запрос1С.УстановитьПараметр("Номер", НомерЗаказа);
        Рез = Запрос1С.Выполнить();
        
        Если Рез.Пустой() Тогда
            Ответ.КодСостояния = 404;
            Ответ.УстановитьТелоИзСтроки("{""error"":""not found"",""orderNo"":""" + НомерЗаказа + """}");
        Иначе
            Ответ.УстановитьТелоИзСтроки("{""status"":""ok"",""orderNo"":""" + НомерЗаказа + """}");
        КонецЕсли;
        
    Исключение
        Ответ.КодСостояния = 500;
        Ответ.УстановитьТелоИзСтроки("{""error"":""" + СтрЗаменить(ОписаниеОшибки(), """", """""") + """}");
    КонецПопытки;
    
    Возврат Ответ;
КонецФункции

Функция ОбработкаGET(Запрос)
    Ответ = Новый HTTPСервисОтвет(200);
    Ответ.УстановитьТелоИзСтроки("OK");
    Возврат Ответ;
КонецФункции
