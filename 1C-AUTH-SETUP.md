# üîê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ HTTP-—Å–µ—Ä–≤–∏—Å–µ 1–°

## ‚ùå –¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞

–í—Å–µ HTTP –∑–∞–ø—Ä–æ—Å—ã –∫ 1–° –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç **401 Unauthorized**.

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è `–ü—Ä–æ–≤–µ—Ä–∏—Ç—å–¢–æ–∫–µ–Ω()` –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã.

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ: 2 –≤–∞—Ä–∏–∞–Ω—Ç–∞

### –í–ê–†–ò–ê–ù–¢ 1: –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–æ–∫–µ–Ω–∞ (–ë—ã—Å—Ç—Ä–æ)

–≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ "–û—à–∏–±–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∞ –ø–æ—Ç–æ–∫–∞" –±–µ–∑ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã.

**–®–∞–≥–∏:**

1. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ç–æ—Ä 1–°
2. –ù–∞–π–¥–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é `–ü—Ä–æ–≤–µ—Ä–∏—Ç—å–¢–æ–∫–µ–Ω()` –≤ HTTP-—Å–µ—Ä–≤–∏—Å–µ
3. –ò–∑–º–µ–Ω–∏—Ç–µ –µ—ë —Ç–∞–∫:

```1c
–§—É–Ω–∫—Ü–∏—è –ü—Ä–æ–≤–µ—Ä–∏—Ç—å–¢–æ–∫–µ–Ω(–¢–æ–∫–µ–Ω–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
    
    // –í–†–ï–ú–ï–ù–ù–û: –æ—Ç–∫–ª—é—á–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    –í–æ–∑–≤—Ä–∞—Ç –ò—Å—Ç–∏–Ω–∞;
    
–ö–æ–Ω–µ—Ü–§—É–Ω–∫—Ü–∏–∏
```

4. –û–ø—É–±–ª–∏–∫—É–π—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:

```bash
curl -X POST http://192.168.100.234/BITtest/hs/lab/attachResult \
  -H "Content-Type: application/json" \
  -d '{"orderNo":"12345","fileName":"test.pdf","fileBase64":"dGVzdA==","sendEmail":false}'
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ `{"error":"Order not found","orderNo":"12345"}` (404) - –æ—Ç–ª–∏—á–Ω–æ!
- ‚ùå `"–û—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –ø–æ—Ç–æ–∫–∞"` (500) - –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å JSON –ø–∞—Ä—Å–∏–Ω–≥

---

### –í–ê–†–ò–ê–ù–¢ 2: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É —Å —Ç–æ–∫–µ–Ω–æ–º (–ü—Ä–∞–≤–∏–ª—å–Ω–æ)

–≠—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± –¥–ª—è production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.

**–®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É (–µ—Å–ª–∏ –µ—ë –Ω–µ—Ç)**

1. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ç–æ—Ä 1–°
2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ‚Üí –û–±—â–∏–µ ‚Üí –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
3. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É:
   - –ò–º—è: `–õ–ò–°_–¢–æ–∫–µ–Ω–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏`
   - –¢–∏–ø: `–°—Ç—Ä–æ–∫–∞` (–¥–ª–∏–Ω–∞: 100)
   - –°–∏–Ω–æ–Ω–∏–º: "–õ–ò–°: –¢–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏"

4. –û–ø—É–±–ª–∏–∫—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

**–®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã**

1. –û—Ç–∫—Ä–æ–π—Ç–µ 1–°:–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ä–µ–∂–∏–º)
2. –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é ‚Üí –ù–°–ò –∏ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Üí –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
3. –ù–∞–π–¥–∏—Ç–µ: `–õ–ò–°_–¢–æ–∫–µ–Ω–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏`
4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ:
   ```
   36765afb2c220c3a22be90cc6e88035332a09f945f392a7ffe00307579867bda
   ```
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ (Ctrl+S)

**–®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –ü—Ä–æ–≤–µ—Ä–∏—Ç—å–¢–æ–∫–µ–Ω**

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:

```1c
–§—É–Ω–∫—Ü–∏—è –ü—Ä–æ–≤–µ—Ä–∏—Ç—å–¢–æ–∫–µ–Ω(–¢–æ–∫–µ–Ω–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
    
    // –ü–æ–ª—É—á–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É —Ç–æ–∫–µ–Ω–∞ –∏–∑ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
    –û–∂–∏–¥–∞–µ–º—ã–π–¢–æ–∫–µ–Ω = –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã.–õ–ò–°_–¢–æ–∫–µ–Ω–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.–ü–æ–ª—É—á–∏—Ç—å();
    
    –ï—Å–ª–∏ –ü—É—Å—Ç–∞—è–°—Ç—Ä–æ–∫–∞(–û–∂–∏–¥–∞–µ–º—ã–π–¢–æ–∫–µ–Ω) –¢–æ–≥–¥–∞
        // –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω, —Ä–∞–∑—Ä–µ—à–∞–µ–º –¥–æ—Å—Ç—É–ø (–Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ!)
        –í–æ–∑–≤—Ä–∞—Ç –ò—Å—Ç–∏–Ω–∞;
    –ö–æ–Ω–µ—Ü–ï—Å–ª–∏;
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ "Bearer TOKEN"
    –ï—Å–ª–∏ –°—Ç—Ä–ù–∞—á–∏–Ω–∞–µ—Ç—Å—è–°(–¢–æ–∫–µ–Ω–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, "Bearer ") –¢–æ–≥–¥–∞
        –¢–æ–∫–µ–Ω = –°—Ä–µ–¥(–¢–æ–∫–µ–Ω–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, 8);
        –í–æ–∑–≤—Ä–∞—Ç –¢–æ–∫–µ–Ω = –û–∂–∏–¥–∞–µ–º—ã–π–¢–æ–∫–µ–Ω;
    –ö–æ–Ω–µ—Ü–ï—Å–ª–∏;
    
    –í–æ–∑–≤—Ä–∞—Ç –õ–æ–∂—å;
    
–ö–æ–Ω–µ—Ü–§—É–Ω–∫—Ü–∏–∏
```

**–®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å**

```bash
curl -X POST http://192.168.100.234/BITtest/hs/lab/attachResult \
  -H "Authorization: Bearer 36765afb2c220c3a22be90cc6e88035332a09f945f392a7ffe00307579867bda" \
  -H "Content-Type: application/json" \
  -d '{"orderNo":"12345","fileName":"test.pdf","fileBase64":"dGVzdA==","sendEmail":false}'
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –≤—ã –Ω–∞—Å—Ç—Ä–æ–∏—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –æ–¥–Ω–∏–º –∏–∑ —Å–ø–æ—Å–æ–±–æ–≤, –∑–∞–ø—É—Å—Ç–∏—Ç–µ:

```bash
cd /opt/lis-md
./test-1c-steps.sh
```

–ò–ª–∏ –≤—Ä—É—á–Ω—É—é:

```bash
# –¢–µ—Å—Ç 1: –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å –±–µ–∑ JSON
curl -X POST http://192.168.100.234/BITtest/hs/lab/attachResult \
  -H "Content-Type: application/json" \
  -d '{"orderNo":"12345","fileName":"test.pdf","fileBase64":"dGVzdA==","sendEmail":false}'

# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
# ‚úÖ {"error":"Order not found"} - –º–µ—Ç–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç!
# ‚ùå "–û—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –ø–æ—Ç–æ–∫–∞" - –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ JSON
```

---

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –ü–æ–ª—É—á–∞—é 401 –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**

1. –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞ –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞
2. –ó–Ω–∞—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ —Ç–æ—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞–µ—Ç:
   ```
   36765afb2c220c3a22be90cc6e88035332a09f945f392a7ffe00307579867bda
   ```
3. –§—É–Ω–∫—Ü–∏—è `–ü—Ä–æ–≤–µ—Ä–∏—Ç—å–¢–æ–∫–µ–Ω()` –ø—Ä–∞–≤–∏–ª—å–Ω–æ —á–∏—Ç–∞–µ—Ç –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É
4. –ò–∑–º–µ–Ω–µ–Ω–∏—è –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω—ã

### –ü–æ–ª—É—á–∞—é 500 "–û—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –ø–æ—Ç–æ–∫–∞"

**–û—Ç–ª–∏—á–Ω–æ!** –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ JSON:

–°–º. —Ñ–∞–π–ª: `FIX-JSON-ERROR.md`

–ó–∞–º–µ–Ω–∏—Ç–µ:
```1c
–ü—Ä–æ—á–∏—Ç–∞—Ç—åJSON(–ß—Ç–µ–Ω–∏–µJSON, –ò—Å—Ç–∏–Ω–∞)  // –°–¢–ê–†–û–ï
```

–ù–∞:
```1c
–ü—Ä–æ—á–∏—Ç–∞—Ç—åJSON(–ß—Ç–µ–Ω–∏–µJSON)  // –ù–û–í–û–ï
–ß—Ç–µ–Ω–∏–µJSON.–ó–∞–∫—Ä—ã—Ç—å();      // –î–æ–±–∞–≤–∏—Ç—å!
```

### –ü–æ–ª—É—á–∞—é 404 "Order not found"

**üéâ –û—Ç–ª–∏—á–Ω–æ!** –í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç! –ú–µ—Ç–æ–¥ –ø–∞—Ä—Å–∏—Ç JSON –∏ –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ –±–∞–∑–µ.

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –Ω–æ–º–µ—Ä–∞–º–∏ –∑–∞–∫–∞–∑–æ–≤.

---

## üìä –¢–æ–∫–µ–Ω—ã –≤ —Å–∏—Å—Ç–µ–º–µ

### –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–∫–µ–Ω?

1. **–í –æ–±–ª–∞—á–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ –õ–ò–°-–ú–î:**
   - –§–∞–π–ª: `/opt/lis-md/.env`
   - –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è: `ONEC_API_TOKEN`
   - –ó–Ω–∞—á–µ–Ω–∏–µ: `36765afb2c220c3a22be90cc6e88035332a09f945f392a7ffe00307579867bda`

2. **–í 1–°:**
   - –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞: `–õ–ò–°_–¢–æ–∫–µ–Ω–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏`
   - –ó–Ω–∞—á–µ–Ω–∏–µ: `36765afb2c220c3a22be90cc6e88035332a09f945f392a7ffe00307579867bda`

–¢–æ–∫–µ–Ω—ã **–î–û–õ–ñ–ù–´** —Å–æ–≤–ø–∞–¥–∞—Ç—å!

### –ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å —Ç–æ–∫–µ–Ω?

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —Ç–æ–∫–µ–Ω:

1. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –Ω–æ–≤—ã–π:
   ```bash
   openssl rand -hex 32
   ```

2. –û–±–Ω–æ–≤–∏—Ç–µ –≤ –æ–±–ª–∞–∫–µ:
   ```bash
   nano /opt/lis-md/.env
   # –ò–∑–º–µ–Ω–∏—Ç–µ ONEC_API_TOKEN=–Ω–æ–≤—ã–π_—Ç–æ–∫–µ–Ω
   docker compose restart app
   ```

3. –û–±–Ω–æ–≤–∏—Ç–µ –≤ 1–°:
   - –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É `–õ–ò–°_–¢–æ–∫–µ–Ω–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏`
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

**–î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –í–∞—Ä–∏–∞–Ω—Ç 1 (–æ—Ç–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É)

**–î–ª—è production:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –í–∞—Ä–∏–∞–Ω—Ç 2 (–Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É)

---

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç –∏ –ø—Ä–∏—à–ª–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç!

